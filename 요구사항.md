# 📘 무노력 자동 기록 서비스 – 요구사항.md (최종본)

본 문서는 Piclog 서비스의 개발, 설계, 유지보수, 리팩토링 및  
Claude Code 바이브 코딩 자동수정의 절대 기준(SSOT, Single Source of Truth)입니다.  
모든 기능은 반드시 본 문서를 기준으로 구현됩니다.

---

# 1. 서비스 개요
Piclog는  
**사용자가 사진만 찍어도 하루 기록이 자동으로 완성되는 무노력(Effortless) 자동 타임라인 서비스**입니다.

핵심 특징:
- 유저가 기록을 작성할 필요 없음  
- 사진을 업로드하거나(웹) 또는 자동 크롤링(앱)  
- 촬영 시간(EXIF 또는 파일명)을 기반으로 자동 시간 정렬  
- 24시간 타임라인 UI 자동 생성을 통해 하루 회고 가능  
- 로그인 없음 → 자동 Guest 계정 기반  

---

# 2. UI 구조 개요

## 2-1. 기본 타임라인 뷰 (Default View)
- 24시간 시간축  
- 사진 1장 = 1개의 카드  
- 사진 촬영 시간대에 따라 자동 배치  
- 카드 구성
  - 이미지  
  - 시간 범위  
  - 라벨(간단 메모)  

---

# 2-2. 요약뷰 (Compact View) **← 신규 추가**
요약뷰는 유저 피드백을 기반으로 추가된 기능으로,  
하루 기록을 **“스크롤 없이 한눈에 볼 수 있는 압축된 형태”**로 제공하는 화면입니다.

### 요약뷰 목적
- 스크롤 부담(가장 큰 불만 요소) 해소  
- 하루 전체의 흐름을 빠르게 파악  
- 시간대별 핵심 사진만 추려서 표시  

### 요약뷰 특징
- 한 줄에 하나의 시간 블록  
- 사진은 작은 썸네일 형태(최대 3장)  
- 사진이 많으면 `+N` 형태로 표시  
- 텍스트 라벨은 10~20자 내로 표시  
- 기본 뷰 ↔ 요약뷰 토글 버튼 제공  

### 요약뷰 예시 형태 (텍스트 와이어프레임)
```
06:00   🖼🖼   아침 요가
08:40   🖼🖼🖼 +2   팀 미팅
12:20   🖼🖼   점심
18:10   🖼🖼🖼   운동
```

### 요약뷰용 컴포넌트
- `CompactViewContainer`
- `CompactTimelineRow`
- `ThumbnailMini`
- `MoreIndicator (+N)`
- `ViewToggleButton`  

---

# 3. 자동 갤러리 크롤링 기능 (핵심 기능)

서비스는 유저 기기(앱 기준) 또는 클라이언트에서  
**정해진 주기마다 갤러리를 자동 스캔하여 새로운 사진을 감지하고 등록하는 기능**을 포함합니다.

### 동작 방식
1. 백그라운드에서 1시간마다 자동 스캔 (기본값)  
2. 새로 촬영된 사진 감지  
3. EXIF 시간 자동 추출  
4. 해당 시간대 타임라인에 자동 추가  
5. 중복된 사진은 제외  
6. Sync 결과를 사용자에게 간단히 표시  

### 자동 동기화 구조
```ts
export type AutoSyncResult = {
  scannedAt: string;
  newPhotos: PhotoItem[];
  skippedCount: number;
};
```

### 자동 동기화 UI
- “새로운 사진 3장이 추가되었습니다”  
- “자동 동기화 중…” 인디케이터  
- 설정에서 스캔 주기 변경 가능  
  (30분 / 1시간 / 3시간 / 하루 1회)  

---

# 4. 데이터 구조

## PhotoItem
```ts
export type PhotoItem = {
  id: string;
  url: string;
  createdAt: string; // EXIF timestamp
  label?: string;
};
```

## TimelineBlock
```ts
export type TimelineBlock = {
  time: string;
  photos: PhotoItem[];
};
```

---

# 5. API 명세

### 사진 업로드  
`POST /api/photos/upload`
```ts
{
  id: string;
  url: string;
  createdAt: string;
  label: string | null;
}
```

### 타임라인 조회  
`GET /api/timeline?date=YYYY-MM-DD`
```ts
TimelineBlock[]
```

### 자동 동기화  
`POST /api/photos/auto-sync`
```ts
AutoSyncResult
```

---

# 6. Supabase DB & Storage

### Storage
- `/photos/{userId}/{filename}`

### DB Schema
```sql
create table photos (
  id uuid primary key default gen_random_uuid(),
  user_id uuid references auth.users(id),
  url text not null,
  created_at timestamptz not null,
  label text,
  created_at_db timestamptz default now()
);
```

---

# 7. 상태 관리 Hooks

```ts
useTimeline(date: string)
usePhotoUpload()
useAutoSync(interval: number)
```

---

# 8. 유저 피드백 기반 개선 사항 (반영됨)

## ✔ 긍정
- 직관적이고 보기 좋은 디자인  
- 하루 회고에 최적화된 흐름  
- 사진 중심의 인터페이스가 이해하기 쉬움  

## ❗ 개선 요청 (요약뷰와 함께 반영)
1) 스크롤 문제 → 요약뷰 도입  
2) 사진 선택/제외 기능 필요  
3) 섹션 접기/압축 필요  
4) 텍스트-사진 구분 강화  
5) 편집 기능 및 상세 보기 요청  

---

# 9. 전체 UI 컴포넌트 구조

```
TimelineContainer
TimeColumn
TimelineSection
PhotoCard
CompactViewContainer
CompactTimelineRow
ThumbnailMini
MoreIndicator
ViewToggleButton
UploadModal
AutoSyncIndicator
SettingsPage
PhotoFilterMenu
```

---

# 10. 기본 폴더 구조
```
app/
components/
hooks/
types/
lib/
app/api/
public/
```

---

본 파일은 Piclog 개발의 **최종 기준 문서(SSOT)**이며  
모든 개발은 반드시 이 문서를 기반으로 진행해야 합니다.
