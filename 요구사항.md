📘 무노력 자동 기록 서비스 – 요구사항.md (최종본 SSOT)

본 문서는 Piclog 서비스의 **개발·UI 설계·구조 설계·리팩토링 및
Claude Code 바이브 코딩 자동수정의 절대 기준(SSOT)**입니다.

모든 기능 및 UI는 반드시 이 문서를 기준으로 구현합니다.

1. 서비스 개요

Piclog는
사용자가 기록을 작성하지 않아도, 사진만으로 하루 타임라인이 자동 생성되는 Effortless 기록 서비스입니다.

핵심 특징:

기록 작성 없음 → 사진 기반 자동 타임라인 생성

웹 업로드 또는 앱 자동 갤러리 크롤링

촬영 시간(EXIF 또는 파일명)을 기준으로 자동 정렬

24시간 기반 시간-이벤트 연결형 UI

로그인 없음 → Guest 계정 기반

2. UI 구조 및 디자인 가이드 (업데이트됨)

이 문서는 Piclog의 UI 기준을 정의하는 공식 설계 문서이며,
Claude Code 자동 수정 시 반드시 우선 적용됨.

2-1. 기본 타임라인 뷰 구조

핵심 개념:

24시간 세로 타임라인

시간 블록(Time Section)마다 노란 세로 선이 독립적으로 존재함

시간 라벨은 왼쪽 column 고정

사진은 카드 없이 PNG 누끼 이미지 그대로 렌더링

2-2. 타임라인 레이아웃 규칙
✔ 전체 구조
[Time Text] | [Yellow Line (per section)] | [Photos]


예시:

09:00   | |(높이=해당 시간대 콘텐츠 높이)|   [PNG 사진]
10:00   | |                                |   [PNG 사진]
11:00   | |                                |   [PNG 사진 2장]

✔ 노란 타임라인 선 (업데이트됨 — 시간대별로 끊어짐)
규칙

타임라인 선은 TimelineSection 내부에만 존재한다.

각 시간대가 독립된 선을 가진다.

선의 height는 해당 섹션의 콘텐츠 높이에 맞춰 자동으로 늘어남.

선의 스타일:

width: 3~4px

background-color: #F5D046

border-radius: 2px

타임라인 스크롤과 관계없이 각 섹션에서만 표시됨.

✔ ‘단일 타임라인 선 컴포넌트’는 사용하지 않음

VerticalLine 하나로 전체를 잇는 구조는 금지됨.

✔ 시간 라벨(TimeColumn)

왼쪽 고정

font-size: 12~13px

color: #333

시간은 YYYY-MM-DD 기준으로 계산된 정각 단위 표시

✔ TimelineSection (시간 블록)

각 시간대는 반드시 아래 형태를 따른다:

TimelineSection(09:00)
  - TimeColumn(09:00)
  - YellowLine(해당 섹션 전용)
  - PhotosContainer (내부에 사진 여러 개 가능)

2-3. 사진 표시 규칙 (겹침 방지 규칙 유지)
✔ 1) position 규칙

position: relative

absolute 금지

display: block

width: auto or 100%

margin-top: 8~16px

→ 이렇게 함으로써 시간대가 다르면 사진은 서로 절대 겹치지 않는다.

✔ 2) 같은 시간대의 여러 사진

순차적으로 블록 형태로 세로 배치

약한 overlap 효과는 선택적으로 가능하나
시간대가 다르다면 겹침 금지

✔ 3) 카드 UI 금지

박스 형태의 wrapper 금지

border, border-radius, 그림자 박스 금지

PNG 누끼 그대로 렌더링

2-4. 시간 간격

시간 블록 간의 최소 높이: 80~110px

블록마다 높이는 내부 사진 개수로 자동 확장

2-5. 시간 간격

기본 간격: 80~110px

시간 간격은 UI 흐름에 따라 조정 가능

2-6. 타임라인 노란색 선 (업데이트됨)
📌 단일 Vertical Line 구조

VerticalLine 컴포넌트를 하나만 생성함

타임라인 전체를 height: 100%로 관통

position 예시:

TimelineContainer (relative)
  └─ VerticalLine (absolute; top: 0; bottom: 0; width: 1px)

📌 끊김이 절대 없어야 함

개별 시간 섹션마다 선을 생성하지 않음.

2-7. 하단 메뉴바 (Fixed Bottom Menu)

“타임라인 보기 / 사진 추가 / 나의 스티커”

아이콘 + 텍스트 조합

bottom: 0; position: fixed

iOS 탭바 스타일

2-8. 사진 드래그 & 위치 조정 기능 (신규 기능)

본 기능은 사용자가 업로드된 사진의 타임라인 내 위치를 자유롭게 조정할 수 있도록 한다.

✔ 기능 개요

타임라인에 표시된 PNG 사진을 사용자가 마우스로 드래그하여
위치(좌/우·상/하)를 변경할 수 있다.

드래그된 위치는 해당 시간대 내에서만 조정되며,
드래그로 시간대 자체가 변경되지는 않는다.

✔ 드래그 가능한 요소 (Draggable Photo Object)

PhotoItem은 TimelineSection 내부에서
draggable: true 속성을 갖는다.

드래그 가능한 범위는 다음과 같다:

X축(좌·우) 자유 이동

Y축(위·아래) 자유 이동 (단, 동일 섹션 내에서만)

✔ 드래그 제약 조건

시간대(Time Section)를 넘어서 이동할 수 없음

드래그가 TimelineSection의 top/bottom을 벗어나면 되돌림

섹션 간 이동은 다른 UX로 고민 (현재는 불가)

다른 사진과의 충돌 감지 최소화

기본적으로 이미지끼리 약간 겹쳐도 허용

완전 겹침 시 자동으로 약간 조정

absolute 기반으로 변환해도 됨
(단, 드래그 완료 후 위치 저장 시 absolute 좌표만 저장)

✔ 드래그 완료 후 저장 (Persisted State)

드래그 후 새 위치는 DB에 아래 형태로 저장한다:

export type PhotoPosition = {
  photoId: string;
  x: number;  // px 단위
  y: number;  // px 단위
};


Supabase의 photos 테이블 혹은 별도 photo_positions 테이블에 저장 가능:

photo_positions {
  id uuid pk,
  photo_id uuid,
  x int,
  y int,
  updated_at timestamptz
}


페이지 새로고침 후에도 위치는 유지됨

요약뷰(Compact View)에서는 드래그 위치는 적용되지 않음

✔ 렌더링 규칙

드래그가 가능한 사진은 다음 스타일을 갖는다:

position: absolute;
cursor: grab;


드래그 중에는:

cursor: grabbing;
opacity: 0.9;
z-index: 10;


드래그 영역은 TimelineSection의 bounding box를 기준으로 제한

✔ 모바일 UX

모바일에서는 long-press(0.3~0.5s) 후 드래그 가능

터치 이동 반영

✔ 예외 처리

사진 삭제 시 position 정보도 삭제

사진이 두 장 이상 겹칠 경우, 마지막 드래그된 요소가 우선순위

2-8. 타임라인 시간-사진 구분용 세로 라인 추가 (신규)

타임라인 가독성을 높이기 위해
각 시간 섹션(TimeSection)에서 시간 표시와 사진 영역 사이에 세로 라인을 추가한다.

✔ 구성 규칙
[시간 텍스트] | [사진 영역]


"|" 에 해당하는 부분은 VerticalDivider 컴포넌트

각 TimelineSection 내부에 존재 (섹션마다 끊어짐)

선 길이 = 해당 섹션의 콘텐츠 높이에 맞춰 자동 확장

컬러는 다음 기준 중 하나 사용:

#E5E5E5 (밝은 회색) 또는

#F5D046(노란 라인)보다 더 자연스럽게 보이는 컬러 자동 선정 가능

✔ 디자인 가이드

width: 2px

opacity: 0.8

border-radius: 2px

left/right padding 고려하여 시간 텍스트와 사진이 붙지 않도록 함

2-9. 타임라인 사진 크기 조절 기능 (확대/축소)

사용자는 타임라인에 나타난 사진을 확대 / 축소하여 크기를 조절할 수 있다.

✔ 조절 방식

스크롤 휠 + Shift 키

사진 클릭 후 나타나는 조절 핸들(우측 하단 resize handle)

모바일: 핀치 제스처(추후)

✔ 저장 방식

사진 크기는 width 기반으로 저장한다.

export type PhotoSize = {
  photoId: string;
  width: number; // px 또는 %
};


Supabase photo_positions 또는 별도 photo_sizes 테이블에 저장

새로고침 후에도 반영

✔ 렌더링 규칙

resize 가능 시: cursor: nwse-resize

최대/최소값:

min-width: 80px

max-width: 400px (또는 부모 영역 기준 70%)

✔ TimelineImage 스타일 규칙 업데이트

드래그 시: position:absolute

resize 시: transform(scale)이 아닌 width 값을 직접 조정

drag + resize 충돌 방지:

크기 조절 중일 때는 drag 비활성화

2-10. 사진 드래그 이동 범위 제한 규칙 (업데이트됨)

타임라인에 업로드된 사진(누끼 PNG 포함)은
반드시 해당 촬영 시간(TimeSection)의 영역을 벗어나 이동할 수 없다.

✔ 드래그 이동 범위 규칙

사진은 촬영 시간이 속한 TimelineSection 내부에서만 이동 가능

상단(top) 경계를 넘어가면 → 자동으로 해당 섹션 내부의 가장 위로 스냅(back)

하단(bottom) 경계를 넘어가면 → 섹션 내부의 가장 아래로 스냅(back)

Time Section 간 이동은 허용하지 않음

즉, 09:16에 찍힌 사진은 항상 09:00~09:59 섹션 안에 존재해야 함

10:00 영역이나 08:00 영역으로 이동 불가

드래그 좌표는 TimelineSection의 bounding box를 기준으로 제한

CSS 기준은 반드시 다음을 따른다:

TimelineSection {
  position: relative;
}
TimelinePhoto {
  position: absolute;
}


absolute 좌표의 기준(부모)이 TimelineSection으로 고정되므로
부모 영역을 벗어난 이동이 실제로 불가능해야 함

드래그 중 제한된 경계에 닿으면 즉시 이동 중단 또는 되돌림 처리

resize(크기 조절) 중에도 동일한 제한 적용

✔ 사진 드래그 좌표 저장 시 규칙

드래그 완료 후 저장되는 x/y 값은
반드시 TimelineSection 내부 좌표 기준이어야 한다.

export type PhotoPosition = {
  photoId: string;
  timeBlockTime: string; // 예: "09:00"
  x: number; // section 내부에서의 x 좌표
  y: number; // section 내부에서의 y 좌표
};

2-11. 타임라인 텍스트 입력 기능 (신규)

타임라인에 사용자가 자유롭게 텍스트를 추가하고,
해당 텍스트를 이동(드래그) 및 크기 조절(확대/축소) 할 수 있다.

✔ 텍스트 객체(TextItem) 정의
export type TextItem = {
  id: string;
  timeBlockTime: string;   // 예: "09:00" — 어떤 시간대에 소속되는지
  content: string;         // 입력한 텍스트
  x: number;               // 섹션 내부 좌표
  y: number;               // 섹션 내부 좌표
  fontSize: number;        // 폰트 크기(px)
};


Supabase에는 text_items 테이블로 저장한다.

✔ 텍스트 추가 기능

사용자는 타임라인 각 시간대에 텍스트 추가 버튼을 클릭하여 텍스트를 입력할 수 있다.

텍스트는 기본 스타일로 생성된다:

fontSize: 16px

color: #333

background: none or light bubble style(선택)

position: absolute

draggable: true

resizable: true

✔ 텍스트 위치 이동 규칙 (드래그 이동)

텍스트도 사진과 동일하게 자신의 TimelineSection 내부에서만 이동 가능하다.

position: absolute

drag constraints = TimelineSection의 bounding box

drag 중에는 z-index 상승

drag 종료 시 {x, y} 위치 저장

✔ 텍스트 크기 조절 규칙 (확대/축소)

텍스트 크기는 폰트 크기(font-size) 조절 방식으로 확장/축소한다.

조절 방식:

텍스트 객체 클릭 시 우측 하단에 resize handle 표시

resize handle을 드래그 → fontSize 변경

최소/최대 사이즈:

min: 10px

max: 60px

크기 조절 중 drag 기능은 일시 비활성화된다 (충돌 방지)

✔ 렌더링 규칙

TextItem은 TimelineSection 내부에서 다음 스타일을 기본으로 갖는다:

position: absolute;
white-space: pre-wrap;
cursor: grab;
padding: 4px 8px;
border-radius: 6px;
background: rgba(255,255,255,0.8); /* 선택 옵션 */
backdrop-filter: blur(4px);        /* 선택 옵션 */


선택 시 외곽선 또는 shadow로 선택 상태를 표현하는 것이 권장된다.

✔ 저장 및 복원 로직

텍스트 객체는 Supabase 테이블에 저장된다:

id (uuid)
content text
x int
y int
font_size int
time_block_time text
updated_at timestamp


타임라인을 로드할 때:

해당 날짜의 text_items 전체를 불러온다

timeBlockTime 기준으로 TimelineSection 내부에 배치

✔ 삭제 기능

텍스트 클릭 > “삭제” 버튼 제공

삭제 시 Supabase에서도 삭제됨


---

# 2-3. 요약뷰 (Compact View) **← 신규 추가**
요약뷰는 유저 피드백을 기반으로 추가된 기능으로,  
하루 기록을 **“스크롤 없이 한눈에 볼 수 있는 압축된 형태”**로 제공하는 화면입니다.

### 요약뷰 목적
- 스크롤 부담(가장 큰 불만 요소) 해소  
- 하루 전체의 흐름을 빠르게 파악  
- 시간대별 핵심 사진만 추려서 표시  

### 요약뷰 특징
- 한 줄에 하나의 시간 블록  
- 사진은 작은 썸네일 형태(최대 3장)  
- 사진이 많으면 `+N` 형태로 표시  
- 텍스트 라벨은 10~20자 내로 표시  
- 기본 뷰 ↔ 요약뷰 토글 버튼 제공  

### 요약뷰 예시 형태 (텍스트 와이어프레임)
```
06:00   🖼🖼   아침 요가
08:40   🖼🖼🖼 +2   팀 미팅
12:20   🖼🖼   점심
18:10   🖼🖼🖼   운동
```

### 요약뷰용 컴포넌트
- `CompactViewContainer`
- `CompactTimelineRow`
- `ThumbnailMini`
- `MoreIndicator (+N)`
- `ViewToggleButton`  

---

# 3. 자동 갤러리 크롤링 기능 (핵심 기능)

서비스는 유저 기기(앱 기준) 또는 클라이언트에서  
**정해진 주기마다 갤러리를 자동 스캔하여 새로운 사진을 감지하고 등록하는 기능**을 포함합니다.

### 동작 방식
1. 백그라운드에서 1시간마다 자동 스캔 (기본값)  
2. 새로 촬영된 사진 감지  
3. EXIF 시간 자동 추출  
4. 해당 시간대 타임라인에 자동 추가  
5. 중복된 사진은 제외  
6. Sync 결과를 사용자에게 간단히 표시  

### 자동 동기화 구조
```ts
export type AutoSyncResult = {
  scannedAt: string;
  newPhotos: PhotoItem[];
  skippedCount: number;
};
```

### 자동 동기화 UI
- “새로운 사진 3장이 추가되었습니다”  
- “자동 동기화 중…” 인디케이터  
- 설정에서 스캔 주기 변경 가능  
  (30분 / 1시간 / 3시간 / 하루 1회)  

---

# 4. 데이터 구조

## PhotoItem
```ts
export type PhotoItem = {
  id: string;
  url: string;
  createdAt: string; // EXIF timestamp
  label?: string;
};
```

## TimelineBlock
```ts
export type TimelineBlock = {
  time: string;
  photos: PhotoItem[];
};
```

---

# 5. API 명세

### 사진 업로드  
`POST /api/photos/upload`
```ts
{
  id: string;
  url: string;
  createdAt: string;
  label: string | null;
}
```

### 타임라인 조회  
`GET /api/timeline?date=YYYY-MM-DD`
```ts
TimelineBlock[]
```

### 자동 동기화  
`POST /api/photos/auto-sync`
```ts
AutoSyncResult
```

---

# 6. Supabase DB & Storage

### Storage
- `/photos/{userId}/{filename}`

### DB Schema
```sql
create table photos (
  id uuid primary key default gen_random_uuid(),
  user_id uuid references auth.users(id),
  url text not null,
  created_at timestamptz not null,
  label text,
  created_at_db timestamptz default now()
);
```

---

# 7. 상태 관리 Hooks

```ts
useTimeline(date: string)
usePhotoUpload()
useAutoSync(interval: number)
```

---

# 8. 유저 피드백 기반 개선 사항 (반영됨)

## ✔ 긍정
- 직관적이고 보기 좋은 디자인  
- 하루 회고에 최적화된 흐름  
- 사진 중심의 인터페이스가 이해하기 쉬움  

## ❗ 개선 요청 (요약뷰와 함께 반영)
1) 스크롤 문제 → 요약뷰 도입  
2) 사진 선택/제외 기능 필요  
3) 섹션 접기/압축 필요  
4) 텍스트-사진 구분 강화  
5) 편집 기능 및 상세 보기 요청  

---

9. 전체 UI 컴포넌트 구조 (업데이트됨)

```
TimelineContainer
TimeColumn
VerticalLine     ← NEW: 단일 타임라인 선
TimelineSection
TimelinePhoto    ← 이미지 전용 컴포넌트 (relative)
CompactViewContainer
CompactTimelineRow
ThumbnailMini
MoreIndicator
ViewToggleButton
UploadModal
AutoSyncIndicator
SettingsPage
PhotoFilterMenu
BottomNavBar
```

---

# 10. 기본 폴더 구조
```
app/
components/
hooks/
types/
lib/
app/api/
public/
```

---

본 파일은 Piclog 개발의 **최종 기준 문서(SSOT)**이며  
모든 개발은 반드시 이 문서를 기반으로 진행해야 합니다.
